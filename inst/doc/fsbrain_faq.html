<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>The fsbrain FAQ</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">The fsbrain FAQ</h1>



<div id="input-data" class="section level2">
<h2>Input data</h2>
<div id="q-what-kind-of-input-data-do-i-need-for-fsbrain" class="section level3">
<h3><strong>Q</strong>: What kind of input data do I need for fsbrain?</h3>
<p>The <em>fsbrain</em> software is designed to be used with the output of <a href="http://freesurfer.net/">FreeSurfer</a>. Running <em>recon-all</em> on your T1w MRI scan results in a directory structure full of different files and file types for each subject. The <em>fsbrain</em> library uses knowledge on this directory layout to load the proper data.</p>
<p>However, while designed primarily with FreeSurfer in mind, fsbrain is not limited to FreeSurfer output, see below.</p>
</div>
<div id="q-which-file-formats-are-supported" class="section level3">
<h3><strong>Q</strong>: Which file formats are supported?</h3>
<p>The <em>fsbrain</em> library uses <a href="https://github.com/dfsp-spirit/freesurferformats">freesurferformats</a> to load a variety of neuroimaging file formats, including data exchange formats used by other brain imaging software. See the <a href="https://github.com/dfsp-spirit/freesurferformats">freesurferformats website</a> for the full list.</p>
</div>
<div id="q-i-want-to-load-a-single-file-that-is-somewhere-on-my-harddisk-i.e.-not-within-a-standard-recon-all-output-directory-structure.-how-can-i-load-it" class="section level3">
<h3><strong>Q</strong>: I want to load a single file that is <em>somewhere</em> on my harddisk, i.e., not within a standard recon-all output directory structure. How can I load it?</h3>
<p>You can use <a href="https://github.com/dfsp-spirit/freesurferformats">freesurferformats</a> directly to load the data, then pass it to <em>fsbrain</em>. See the next question for an example.</p>
</div>
<div id="q-can-i-use-fsbrain-to-visualize-data-from-spm12-cat12-or-other-software-packages" class="section level3">
<h3><strong>Q</strong>: Can I use fsbrain to visualize data from SPM12 / CAT12 or other software packages?</h3>
<p>Yes, the <a href="http://www.neuro.uni-jena.de/cat/">computational anatomy toolbox (CAT12)</a> for <a href="https://www.fil.ion.ucl.ac.uk/spm/">SPM</a> writes surfaces in GIFTI format and the morphometry data in curv format, both formats are supported by <em>fsbrain</em>. After running CAT12 surface measure computation on your subject <code>subject1</code>, you should have the following files in the <em>surf/</em> subdir:</p>
<ul>
<li>lh.central.subject1.gii</li>
<li>lh.gyrification.subject1</li>
</ul>
<p>Try the following to visualize the gyrification data for the left hemisphere in <em>fsbrain</em>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>lh_surf =<span class="st"> </span>freesurferformats<span class="op">::</span><span class="kw">read_nisurface</span>(<span class="st">&#39;~/data/subject1_spm12/surf/lh.central.subject1.gii&#39;</span>);</span>
<span id="cb1-2"><a href="#cb1-2"></a>lh_gyrification =<span class="st"> </span>freesurferformats<span class="op">::</span><span class="kw">read.fs.curv</span>(<span class="st">&#39;~/data/subject1_spm12/surf/lh.gyrification.subject1&#39;</span>);</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">vis.data.on.subject</span>(<span class="st">&#39;~/data/&#39;</span>, <span class="st">&#39;subject1_spm12&#39;</span>, lh_gyrification, <span class="ot">NULL</span>, <span class="dt">surface=</span>lh_surf);</span></code></pre></div>
<p>You should be able to load data from a number of different neuroimaging software packages with freesurferformats, as it supports the very common NIFTI and GIFTI file formats.</p>
</div>
</div>
<div id="visualization" class="section level2">
<h2>Visualization</h2>
<div id="how-can-i-set-the-output-image-resolution" class="section level3">
<h3>How can I set the output image resolution?</h3>
<p>To increase the output resolution, you need to increase the size of the <em>rgl</em> rendering device. To do this globally, before you call any <em>fsbrain</em> rendering function:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">fsbrain.set.default.figsize</span>(<span class="dv">1200</span>, <span class="dv">1200</span>);</span></code></pre></div>
<p>Alternatively, you can control the size when calling an <em>fsbrain</em> visualization function by passing the same information in the optional <code>rgloptions</code> parameter, like this:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>rgloptions =<span class="st"> </span><span class="kw">list</span>(<span class="st">&#39;windowRect&#39;</span>=<span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">1800</span>, <span class="dv">1200</span>));</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">vis.subject.morph.native</span>(<span class="st">&#39;~/mysubjects_dir&#39;</span>, <span class="st">&#39;subject1&#39;</span>, <span class="st">&#39;thickness&#39;</span>, <span class="dt">rgloptions=</span>rgloptions);</span></code></pre></div>
</div>
<div id="how-can-i-save-high-quality-figures-to-png-images" class="section level3">
<h3>How can I save high quality figures to PNG images?</h3>
<p>Note that fsbrain renders images, which means the output is pixel-based (i.e., bitmap as opposed to vector graphics). To get high quality output, you need to increase the size of the <em>rgl</em> rendering device, as explained in the last question.</p>
<p>To save the plot to a file in PNG format, you can use an rglaction:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>rgla =<span class="st"> </span><span class="kw">list</span>(<span class="st">&#39;snapshot_png&#39;</span>=<span class="st">&#39;~/subject1_thickness.png&#39;</span>);</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw">vis.subject.morph.native</span>(<span class="st">&#39;~/mysubjects_dir&#39;</span>, <span class="st">&#39;subject1&#39;</span>, <span class="st">&#39;thickness&#39;</span>, <span class="dt">rglactions=</span>rgla);</span></code></pre></div>
<p>This opens the plot in a window as usual and also saves it in PNG format to the file <em>subject1_thickness.png</em> in your home directory.</p>
</div>
<div id="when-visualizing-data-with-outliers-and-long-tails-the-colors-are-not-helpful.-what-to-do" class="section level3">
<h3>When visualizing data with outliers and long tails, the colors are not helpful. What to do?</h3>
<p>If you have data with very few but extreme outliers, almost all of your plot will have a single color. This happens for example when plotting curvature data. You can of course first load the data using <code>subject.morph.native</code>, adjust it (transform it, remove outliers), and then plot it using <code>vis.data.on.subject</code>.</p>
<p>In many cases, it is easier to use <code>rglactions</code> to clip the data to the 5th to 95th percentile, which can be done with an rglaction. E.g.:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>rgla =<span class="st"> </span><span class="kw">list</span>(<span class="st">&#39;trans_fun&#39;</span>=clip.data);</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw">vis.subject.morph.native</span>(<span class="st">&#39;~/mysubjects_dir&#39;</span>, <span class="st">&#39;subject1&#39;</span>, <span class="st">&#39;curv&#39;</span>, <span class="dt">rglactions=</span>rgla);</span></code></pre></div>
</div>
<div id="can-i-limit-the-data-range-including-the-min-and-max-values-displayed-on-the-color-bar" class="section level3">
<h3>Can I limit the data range, including the min and max values displayed on the color bar?</h3>
<p>Yes, this can be achieved in different ways:</p>
<p>Option 1: Use <code>rglactions</code> in combination with <code>limit_fun</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>rgla =<span class="st"> </span><span class="kw">list</span>(<span class="st">&#39;trans_fun&#39;</span>=<span class="kw">limit_fun</span>(<span class="dv">2</span>,<span class="dv">3</span>));</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">vis.subject.morph.native</span>(<span class="st">&#39;~/mysubjects_dir&#39;</span>, <span class="st">&#39;subject1&#39;</span>, <span class="st">&#39;thickness&#39;</span>, <span class="dt">rglactions =</span> rgla);</span></code></pre></div>
<p>This will limit your data to the range 2 to 3.</p>
<p>If you want the data values outside the given range to be plotted as background (in the color for <code>NA</code> values), use <code>limit_fun_na</code> instead of <code>limit_fun</code>.</p>
<p>Option 2: If you want more flexibility, e.g., you also need support for a larger data range than the real data range of your subject, e.g., when plotting group data to ensure that all subjects use the same colors for identical values, you should use the ‘range’ entry in ‘makecmap_options’ instead:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>makecmap_options =<span class="st"> </span><span class="kw">list</span>(<span class="st">&#39;range&#39;</span>=<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">6</span>));</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">vis.subject.morph.native</span>(<span class="st">&#39;~/mysubjects_dir&#39;</span>, <span class="st">&#39;subject1&#39;</span>, <span class="st">&#39;thickness&#39;</span>, <span class="dt">makecmap_options =</span> makecmap_options);</span></code></pre></div>
</div>
<div id="how-can-i-change-the-colormap-for-the-plots" class="section level3">
<h3>How can I change the colormap for the plots?</h3>
<p>Pass a colormap function to any visualization function that supports the <em>makecmap_options</em> parameter, as entry <em>colFn</em> like illustrated below:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>makecmap_options =<span class="st"> </span><span class="kw">list</span>(<span class="st">&#39;colFn&#39;</span>=viridis<span class="op">::</span>viridis);</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw">vis.subject.morph.native</span>(<span class="st">&#39;~/mysubjects_dir&#39;</span>, <span class="st">&#39;subject1&#39;</span>, <span class="st">&#39;thickness&#39;</span>, <span class="dt">makecmap_options=</span>makecmap_options);</span></code></pre></div>
<p>In that example, we used the popular <em>viridis</em> colormap. In R, it is available from the <em>viridis</em> package. If you don’t have it, you can install it with:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">install.packages</span>(<span class="st">&#39;viridis&#39;</span>);</span></code></pre></div>
<p>Of course, you can use any colormap function you want, currently the only limitation is that it should accept an integer parameter: the requested number of colors.</p>
<p>The exact number of colors that will be requested depends on your data, and if the colormap you want only supports very few colors, you can use a wrapper function to interpolate. Here is an example for the very popular <em>RColorBrewer</em> package. Some of its colormaps have less than 10 colors, which is usually not enough for neuroimaging data. Here we wrap the ‘Blues’ palette, which has 9 colors:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>colFn_many_blues =<span class="st"> </span><span class="kw">colorRampPalette</span>(RColorBrewer<span class="op">::</span><span class="kw">brewer.pal</span>(<span class="dv">9</span>, <span class="dt">name=</span><span class="st">&quot;Blues&quot;</span>));</span>
<span id="cb10-2"><a href="#cb10-2"></a>makecmap_options =<span class="st"> </span><span class="kw">list</span>(<span class="st">&#39;colFn&#39;</span>=colFn_many_blues);</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="kw">vis.subject.morph.native</span>(<span class="st">&#39;~/mysubjects_dir&#39;</span>, <span class="st">&#39;subject1&#39;</span>, <span class="st">&#39;thickness&#39;</span>, <span class="dt">makecmap_options=</span>makecmap_options);</span></code></pre></div>
</div>
<div id="what-are-the-best-colormaps-for-my-data" class="section level3">
<h3>What are the best colormaps for my data?</h3>
<p>Choosing a colormap can be a surprisingly complex question and there are many publications which discuss this topic. You may want to consider what kind of data you have and what property you want to highlight, how many colors you need, whether you want colorblind-friendly colors, how they look when printed in gray-scale, whether they look pleasing to you, and maybe many more dimensions.</p>
<p>The most important thing is to decide is whether you need a sequential, qualitative, or diverging palette for your data.</p>
<p>I am definitely not an expert, but here are some color functions I personally like and use with fsbrain:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>colFn_sequential =<span class="st"> </span>viridis<span class="op">::</span>viridis;</span>
<span id="cb11-2"><a href="#cb11-2"></a>colFn_qualitative =<span class="st"> </span><span class="cf">function</span>(n) { RColorBrewer<span class="op">::</span><span class="kw">brewer.pal</span>(n, <span class="dt">name=</span><span class="st">&quot;Set2&quot;</span>); } <span class="co"># n &lt;= 11</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>colFn_diverging =<span class="st"> </span>grDevices<span class="op">::</span><span class="kw">colorRampPalette</span>(RColorBrewer<span class="op">::</span><span class="kw">brewer.pal</span>(<span class="dv">11</span>, <span class="dt">name=</span><span class="st">&quot;RdBu&quot;</span>));</span></code></pre></div>
<p>They require the <em>viridis</em> and <em>RColorBrewer</em> packages to be installed. The qualitative map is fine if you do not have more than 11 different values.</p>
<p>If you have R &gt;= 3.6, you may not need any extra packages: have a look at the <code>grDevices::hcl.colors</code> function. Here are some suggestions:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>colFn_sequential =<span class="st"> </span><span class="cf">function</span>(n) { grDevices<span class="op">::</span><span class="kw">hcl.colors</span>(n, <span class="dt">palette =</span> <span class="st">&quot;viridis&quot;</span>); }</span>
<span id="cb12-2"><a href="#cb12-2"></a>colFn_qualitative =<span class="st"> </span><span class="cf">function</span>(n) { grDevices<span class="op">::</span><span class="kw">hcl.colors</span>(n, <span class="dt">palette =</span> <span class="st">&quot;Dark 3&quot;</span>); }</span>
<span id="cb12-3"><a href="#cb12-3"></a>colFn_diverging =<span class="st"> </span><span class="cf">function</span>(n) { grDevices<span class="op">::</span><span class="kw">hcl.colors</span>(n, <span class="dt">palette =</span> <span class="st">&quot;Blue-Red 3&quot;</span>); }</span></code></pre></div>
<p>If you want a heatmap-style colormap (single hue sequential, yellow/red), try:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>colFn_sequential_heat =<span class="st"> </span><span class="cf">function</span>(n) { grDevices<span class="op">::</span><span class="kw">hcl.colors</span>(n, <span class="st">&quot;YlOrRd&quot;</span>); }</span></code></pre></div>
<p>Make sure to read the next entry as well if you are using a diverging colormap.</p>
</div>
<div id="i-am-using-a-diverging-colormap.-when-plotting-the-colorbar-legend-the-neutral-value-is-not-at-zero.-how-to-fix-it" class="section level3">
<h3>I am using a diverging colormap. When plotting the colorbar (legend), the neutral value is not at zero. How to fix it?</h3>
<p>When using a diverging colormap, make sure to set the <em>symm</em> option to <em>makecmap_options</em> when using a visualization function, like this:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>makecmap_options =<span class="st"> </span><span class="kw">list</span>(<span class="st">&#39;colFn&#39;</span>=colFn_diverging, <span class="st">&#39;symm&#39;</span>=<span class="ot">TRUE</span>);</span></code></pre></div>
<p>This ensures that the neutral color of the diverging colormap (usually white) is aligned with the zero mark in the colorbar/legend, by adapting the value range displayed on the colorbar.</p>
</div>
<div id="the-colorbar-shows-only-very-few-different-colors-why-is-that-and-how-can-i-change-it" class="section level3">
<h3>The colorbar shows only very few different colors, why is that and how can I change it?</h3>
<p>The impression that the numbers of colors in the colorbar is lower than in the rendered image is a consequence of the rendering process: the lighting (shadows, highlights) and the material properties (glossyness, partial transparency) have an effect on the appearance of colors in the rendered image.</p>
<p>You can set the parameter <em>n</em> in the <em>makecmap_options</em> (see above) to request more colors, which will lead to a smooth colorbar.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>mkc =<span class="st"> </span><span class="kw">list</span>(<span class="st">&#39;n&#39;</span>=200L);</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="kw">vis.subject.morph.native</span>(<span class="st">&#39;~/mysubjects_dir&#39;</span>, <span class="st">&#39;subject1&#39;</span>, <span class="st">&#39;thickness&#39;</span>, <span class="dt">makecmap_options=</span>mkc);</span></code></pre></div>
<p>This also means that more colors are used in the rendered image, but the effect will be less noticable.</p>
</div>
<div id="can-i-set-a-custom-color-for-na-values-in-the-plot-like-the-masked-medial-wall" class="section level3">
<h3>Can I set a custom color for NA values in the plot, like the masked medial wall?</h3>
<p>By default, NA values are rendered in white. You can change this using col.na in makecmap_options:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>mkc =<span class="st"> </span><span class="kw">list</span>(<span class="st">&#39;n&#39;</span>=200L, <span class="st">&#39;col.na&#39;</span>=<span class="st">&#39;orange&#39;</span>);</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="kw">vis.subject.morph.native</span>(<span class="st">&#39;~/mysubjects_dir&#39;</span>, <span class="st">&#39;subject1&#39;</span>, <span class="st">&#39;thickness&#39;</span>, <span class="dt">cortex_only =</span> <span class="ot">TRUE</span>, <span class="dt">makecmap_options=</span>mkc);</span></code></pre></div>
<p>This is also useful when plotting clusters, just set all values which are not part of any cluster to NA.</p>
</div>
<div id="can-i-get-a-color-legend-when-plotting-atlas-regions-from-an-annotation-i-want-to-know-the-region-names-for-the-colors." class="section level3">
<h3>Can I get a color legend when plotting atlas regions from an annotation? I want to know the region names for the colors.</h3>
<p>Yes, see the answer to the next question for details.</p>
</div>
<div id="can-i-get-a-color-legend-when-plotting-a-segmentationparcellation-different-brain-regions-based-on-a-color-lookup-table-like-the-freesurfercolorlut.txt-file" class="section level3">
<h3>Can I get a color legend when plotting a segmentation/parcellation (different brain regions), based on a color lookup table (like the <em>FreeSurferColorLUT.txt</em> file)?</h3>
<p>Yes, use the <code>vis.colortable.legend</code> function. You can pass an annotation or a color lookup table, and it will create a plot that shows the colors and the structure (or region) names. The output will be a separate plot, so you can use standard R methods to save it in vector formats like PDF for best quality.</p>
<p>Hint: you can load a color lookup table with <code>freesurferformats::read.fs.colortable</code>.</p>
</div>
<div id="there-is-too-much-whitespace-between-the-different-views-of-the-brain.-how-can-i-reduce-it" class="section level3">
<h3>There is too much whitespace between the different views of the brain. How can I reduce it?</h3>
<p>While this is not possible in <code>rgl</code>, fsbrain provides the <code>vislayout.from.coloredmeshes</code> function to achieve this using Image Magick. You need to have the suggested ‘magick’ package installed for this to work. The function renders separate images, crops the output figures to remove the background, then merges the seperate cropped images into a final output image and saves it as a PNG file. Here is a usage example:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># To get coloredmeshes return value only, ignore the visualization:</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>cm =<span class="st"> </span><span class="kw">vis.subject.morph.native</span>(sjd, sj, <span class="st">&#39;thickness&#39;</span>, <span class="dt">makecmap_options =</span> <span class="kw">list</span>(<span class="st">&#39;n&#39;</span>=<span class="dv">200</span>), <span class="dt">cortex_only =</span> T);</span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="co"># Produce high quality tight layout:</span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="kw">vislayout.from.coloredmeshes</span>(cm);</span></code></pre></div>
<p>Note that your output resolution settings (see question above) now count for each of the single images. This means that you will get quite high resolution output in combination with the tight layout. This makes the function ideal for producing plots for publications.</p>
<p>You can adjust various settings, e.g., change the rendering style, select different views, and save it to a custom file name in your home directory:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>output_brain_img =<span class="st"> &quot;fsbrain_arranged.png&quot;</span>;</span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="kw">vislayout.from.coloredmeshes</span>(cm, <span class="dt">view_angles =</span> <span class="kw">get.view.angle.names</span>(<span class="dt">angle_set=</span><span class="st">&#39;t9&#39;</span>), <span class="dt">output_img =</span> output_brain_img);</span></code></pre></div>
<p>It is also possible to plot a separate colorbar image and combine that with the tight layout brainview image. Note that the settings for the colorbar are stored in the coloredmeshes, and can be adjusted by altering the initial call to <code>vis.subject.morph.native</code> (or whatever visualization function you use) above.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>output_cbar_img =<span class="st"> &quot;fsbrain_cbar.png&quot;</span>;</span>
<span id="cb19-2"><a href="#cb19-2"></a>output_final_img =<span class="st"> &quot;fsbrain_merged.png&quot;</span>;</span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="kw">coloredmesh.plot.colorbar.separate</span>(cm, <span class="dt">image.plot_extra_options =</span> <span class="kw">list</span>(<span class="st">&#39;horizontal&#39;</span> =<span class="st"> </span><span class="ot">TRUE</span>), <span class="dt">png_options =</span> <span class="kw">list</span>(<span class="st">&#39;filename&#39;</span>=output_cbar_img, <span class="st">&#39;width&#39;</span>=<span class="dv">1800</span>));</span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="kw">combine.colorbar.with.brainview.image</span>(output_brain_img, output_cbar_img, output_final_img);</span></code></pre></div>
<p>You may have to play a bit with the resolution settings of your brain images and the colorbar to get this right (the background cropping makes it hard to compute the exact values in advance).</p>
<p>You should also have a look at the new <code>vis.export.from.coloredmeshes</code> function.</p>
</div>
<div id="when-visualizing-data-on-the-inflated-surface-the-left-and-right-hemisphere-overlap-and-look-garbled.-how-to-fix-that" class="section level3">
<h3>When visualizing data on the inflated surface, the left and right hemisphere overlap and look garbled. How to fix that?</h3>
<p>This happens due to the inflation. One can use the <code>rglactions</code> parameter to push the hemis apart. By default, it pushes them apart by the amount they overlap:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">vis.subject.morph.native</span>(sjd, sj, <span class="st">&#39;thickness&#39;</span>, <span class="dt">rglactions =</span> <span class="kw">list</span>(<span class="st">&#39;shift_hemis_apart&#39;</span>=<span class="ot">TRUE</span>), <span class="dt">surface=</span><span class="st">&#39;inflated&#39;</span>, <span class="dt">views=</span><span class="st">&#39;si&#39;</span>);</span></code></pre></div>
<p>You can also set a distance manually:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw">vis.subject.morph.native</span>(sjd, sj, <span class="st">&#39;thickness&#39;</span>, <span class="dt">rglactions =</span> <span class="kw">list</span>(<span class="st">&#39;shift_hemis_apart&#39;</span>=<span class="kw">list</span>(<span class="st">&#39;min_dist&#39;</span>=<span class="dv">20</span>)), <span class="dt">surface=</span><span class="st">&#39;inflated&#39;</span>, <span class="dt">views=</span><span class="st">&#39;si&#39;</span>);</span></code></pre></div>
<p>If you need more customization options, have a look at the <code>shift.hemis.apart</code> function. If you pass a named list in the rglactions for ‘shift_hemis_apart’ (like in the previous example), the entries are passed on to that function.</p>
</div>
</div>
<div id="various-topics" class="section level2">
<h2>Various topics</h2>
<div id="can-i-integrate-the-plots-produced-by-fsbrain-into-an-r-markdown-document-the-r-equivalent-of-a-python-jupyter-notebook" class="section level3">
<h3>Can I integrate the plots produced by <em>fsbrain</em> into an R Markdown document (the R equivalent of a Python Jupyter notebook)?</h3>
<p>Yes, see the example notebook files in the directory <a href="https://github.com/dfsp-spirit/fsbrain/tree/master/web/Rmd_web_examples">web</a> of the <em>fsbrain</em> repository. The Rmd files are actually notebooks in R markdown format.</p>
</div>
<div id="can-i-use-fsbrain-to-visualize-arbitrary-triangular-meshes-in-r" class="section level3">
<h3>Can I use fsbrain to visualize arbitrary triangular meshes in R?</h3>
<p>Yes, <em>fsbrain</em> is not limited to brain surface meshes, and a wide array of mesh file formats are supported. Keep in mind though that fsbrain works with triangular meshes. To visualize a mesh from a file, the easiest way is to use <code>vis.fs.surface</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">vis.fs.surface</span>(<span class="st">&#39;~/Documents/my_mesh.ply&#39;</span>);</span></code></pre></div>
</div>
</div>
<div id="technical-problems" class="section level2">
<h2>Technical problems</h2>
<div id="i-am-getting-the-error-invalid-value-specified-for-graphical-parameter-plt-why" class="section level3">
<h3>I am getting the error ‘invalid value specified for graphical parameter plt’, why?</h3>
<p>The full error most likely looks like this, or similar:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>Error <span class="cf">in</span> <span class="kw">par</span>(<span class="dt">new =</span> <span class="ot">TRUE</span>, <span class="dt">pty =</span> <span class="st">&quot;m&quot;</span>, <span class="dt">plt =</span> smallplot, <span class="dt">err =</span> <span class="dv">-1</span>) <span class="op">:</span><span class="st"> </span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="st">  </span>invalid value specified <span class="cf">for</span> graphical parameter <span class="st">&quot;plt&quot;</span></span></code></pre></div>
<p>If you experience this error, it most likely happened when you tried to plot something with a colorbar, and did not increase the device size (image resolution). The error occurs if there is no space for the colorbar plot, and the solution is to increase the resolution as explained in the answer to the question ‘How can I set the output image resolution?’ above.</p>
</div>
<div id="i-am-getting-the-error-error-in-squashcmap-found-x-values-outside-map-range" class="section level3">
<h3>I am getting the error ‘Error in squash::cmap, found x values outside map range’</h3>
<p>This can happen when visualizing morphometry data with function like <code>vis.subject.morph.native</code>. The full error most likely looks like this, or similar:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="kw">vis.subject.morph.native</span>(sjd, sj, <span class="st">&#39;your_measure_here&#39;</span>)</span>
<span id="cb24-2"><a href="#cb24-2"></a>Error <span class="cf">in</span> squash<span class="op">::</span><span class="kw">cmap</span>(lh_morph_data, <span class="dt">map =</span> common_cmap) <span class="op">:</span><span class="st"> </span></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="st">  </span>Found <span class="dv">2193</span> values outside map range.</span></code></pre></div>
<p>Most likely you have <code>Inf</code> values in your data, most likely in the medial wall, just try plotting without it:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw">vis.subject.morph.native</span>(sjd, sj, <span class="st">&#39;your_measure_here&#39;</span>, <span class="dt">cortex_only =</span> T)</span></code></pre></div>
<p>If this does not help, load the data and inspect it manually.</p>
</div>
<div id="i-am-getting-the-warning-rgl-unable-to-open-x11-display-when-loading-fsbrain" class="section level3">
<h3>I am getting the warning ‘RGL: unable to open X11 display’ when loading fsbrain</h3>
<p>The full message most likely looks like this:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>Warning messages<span class="op">:</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="dv">1</span><span class="op">:</span><span class="st"> </span>In <span class="kw">rgl.init</span>(initValue, onlyNULL) <span class="op">:</span><span class="st"> </span>RGL<span class="op">:</span><span class="st"> </span>unable to open X11 display</span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="dv">2</span><span class="op">:</span><span class="st"> &#39;rgl.init&#39;</span> failed, running with <span class="st">&#39;rgl.useNULL = TRUE&#39;</span>.</span></code></pre></div>
<p>This happens if you do not have X11, or no window can be opened. Possible reasons include that you are running R on a remote host using an SSH connection without X11 forwarding, or that you do not have XQuartz installed under MacOS.</p>
</div>
<div id="i-am-trying-to-plot-a-very-large-image-with-fsbrain-but-the-output-is-not-as-large-as-expected.-why" class="section level3">
<h3>I am trying to plot a very large image with fsbrain, but the output is not as large as expected. Why?</h3>
<p>The output dimensions are limited by your screen resolution.</p>
</div>
<div id="what-to-do-about-the-error-lazy-load-database-is-corrupt-when-loading-fsbrain" class="section level3">
<h3>What to do about the error ‘lazy-load database is corrupt’ when loading fsbrain?</h3>
<p>If you install the development version from github and try to load it without restarting R, you ma^y get this error:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="kw">library</span>(<span class="st">&quot;fsbrain&quot;</span>)</span>
<span id="cb27-2"><a href="#cb27-2"></a>Error<span class="op">:</span><span class="st"> </span>package or namespace load failed <span class="cf">for</span> ‘fsbrain’ <span class="cf">in</span> <span class="kw">get</span>(method, <span class="dt">envir =</span> home)<span class="op">:</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>lazy<span class="op">-</span>load database <span class="st">&#39;/Users/youruser/Library/R/3.6/library/fsbrain/R/fsbrain.rdb&#39;</span> is corrupt</span></code></pre></div>
<p>To fix this, simply restart R.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
